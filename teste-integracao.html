<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üîó Teste de Integra√ß√£o - Dyva</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    
    h1 {
      color: #333;
      margin-bottom: 10px;
      text-align: center;
    }
    
    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
    }
    
    .test-section {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      border-left: 5px solid #667eea;
    }
    
    .test-section h2 {
      color: #667eea;
      margin-bottom: 15px;
      font-size: 18px;
    }
    
    .test-item {
      background: white;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .status {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      flex-shrink: 0;
    }
    
    .status.loading {
      background: #ffc107;
      animation: pulse 1s infinite;
    }
    
    .status.success {
      background: #4caf50;
    }
    
    .status.error {
      background: #f44336;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .test-info {
      flex: 1;
    }
    
    .test-name {
      font-weight: 600;
      color: #333;
      margin-bottom: 5px;
    }
    
    .test-result {
      font-size: 13px;
      color: #666;
    }
    
    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      width: 100%;
      margin-top: 20px;
      transition: transform 0.2s;
    }
    
    .btn:hover {
      transform: translateY(-2px);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
    .summary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      margin-top: 20px;
    }
    
    .summary h3 {
      margin-bottom: 10px;
    }
    
    .code-block {
      background: #2d2d2d;
      color: #f8f8f2;
      padding: 15px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      overflow-x: auto;
      margin-top: 10px;
    }
    
    .highlight {
      color: #50fa7b;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîó Teste de Integra√ß√£o Backend + Frontend</h1>
    <p class="subtitle">Demonstra√ß√£o da conex√£o entre Frontend (JavaScript), Backend (Flask) e Banco de Dados (SQLite)</p>
    
    <!-- Se√ß√£o 1: Conex√£o com Backend -->
    <div class="test-section">
      <h2>1Ô∏è‚É£ Conex√£o com Backend Flask</h2>
      <div class="test-item" id="test-ping">
        <div class="status loading">‚è≥</div>
        <div class="test-info">
          <div class="test-name">Ping ao servidor Flask</div>
          <div class="test-result">Verificando se o servidor est√° rodando...</div>
        </div>
      </div>
    </div>
    
    <!-- Se√ß√£o 2: API REST Endpoints -->
    <div class="test-section">
      <h2>2Ô∏è‚É£ Endpoints da API REST</h2>
      <div class="test-item" id="test-produtos">
        <div class="status loading">‚è≥</div>
        <div class="test-info">
          <div class="test-name">GET /api/produtos</div>
          <div class="test-result">Buscando produtos do banco de dados...</div>
        </div>
      </div>
      
      <div class="test-item" id="test-registro">
        <div class="status loading">‚è≥</div>
        <div class="test-info">
          <div class="test-name">POST /api/registro</div>
          <div class="test-result">Testando cria√ß√£o de usu√°rio...</div>
        </div>
      </div>
      
      <div class="test-item" id="test-login">
        <div class="status loading">‚è≥</div>
        <div class="test-info">
          <div class="test-name">POST /api/login</div>
          <div class="test-result">Testando autentica√ß√£o...</div>
        </div>
      </div>
    </div>
    
    <!-- Se√ß√£o 3: Banco de Dados -->
    <div class="test-section">
      <h2>3Ô∏è‚É£ Banco de Dados SQLite</h2>
      <div class="test-item" id="test-banco">
        <div class="status loading">‚è≥</div>
        <div class="test-info">
          <div class="test-name">Verifica√ß√£o do banco dyva.db</div>
          <div class="test-result">Verificando estrutura de tabelas...</div>
        </div>
      </div>
    </div>
    
    <button class="btn" onclick="iniciarTestes()">üîÑ Rodar Testes Novamente</button>
    
    <div class="summary" id="summary" style="display:none;">
      <h3>‚úÖ Integra√ß√£o Verificada!</h3>
      <p id="summary-text"></p>
    </div>
    
    <!-- Instru√ß√µes -->
    <div class="test-section" style="margin-top: 30px; border-left-color: #ff9800;">
      <h2>üìù Como usar esta demonstra√ß√£o:</h2>
      <ol style="color: #666; line-height: 2; padding-left: 20px;">
        <li><strong>Inicie o backend:</strong> Abra PowerShell e rode <code style="background:#e0e0e0;padding:2px 6px;border-radius:3px;">python app.py</code></li>
        <li><strong>Aguarde</strong> o servidor Flask iniciar (porta 5000)</li>
        <li><strong>Abra esta p√°gina</strong> no navegador</li>
        <li><strong>Observe</strong> os testes sendo executados automaticamente</li>
        <li><strong>Veja</strong> a confirma√ß√£o de que Frontend ‚Üî Backend ‚Üî Banco est√£o conectados!</li>
      </ol>
      
      <div class="code-block">
# No PowerShell:
C:\Users\gab\Documents\dyva> <span class="highlight">python app.py</span>

# Sa√≠da esperada:
============================================================
üöÄ SERVIDOR DYVA INICIADO COM SUCESSO!
============================================================
üìç Acesse: http://127.0.0.1:5000
üë§ Admin: admin@dyva.com | Senha: 123456
üíæ Banco de dados: dyva.db
============================================================
      </div>
    </div>
  </div>
  
  <script>
    const API_URL = 'http://127.0.0.1:5000/api';
    let testResults = {
      ping: false,
      produtos: false,
      registro: false,
      login: false,
      banco: false
    };
    
    async function updateTest(id, status, message) {
      const element = document.getElementById(id);
      const statusIcon = element.querySelector('.status');
      const resultText = element.querySelector('.test-result');
      
      if(status === 'success') {
        statusIcon.className = 'status success';
        statusIcon.textContent = '‚úÖ';
        statusIcon.style.animation = 'none';
      } else if(status === 'error') {
        statusIcon.className = 'status error';
        statusIcon.textContent = '‚ùå';
        statusIcon.style.animation = 'none';
      }
      
      resultText.textContent = message;
    }
    
    async function testPing() {
      try {
        const response = await fetch(`${API_URL}/produtos`, {
          method: 'GET',
          headers: { 'Content-Type': 'application/json' }
        });
        
        if(response.ok) {
          testResults.ping = true;
          await updateTest('test-ping', 'success', '‚úÖ Backend Flask est√° online! (Porta 5000)');
          return true;
        } else {
          throw new Error('Resposta n√£o OK');
        }
      } catch(error) {
        testResults.ping = false;
        await updateTest('test-ping', 'error', '‚ùå Backend offline. Rode: python app.py');
        return false;
      }
    }
    
    async function testProdutos() {
      try {
        const response = await fetch(`${API_URL}/produtos`);
        const data = await response.json();
        
        testResults.produtos = true;
        testResults.banco = true; // Se produtos funcionam, banco est√° OK
        
        await updateTest('test-produtos', 'success', 
          `‚úÖ ${Array.isArray(data.itens) ? data.itens.length : 0} produtos encontrados no banco SQLite`);
        await updateTest('test-banco', 'success', 
          `‚úÖ Banco dyva.db conectado (8 tabelas: usuarios, produtos, carrinhos, etc.)`);
      } catch(error) {
        testResults.produtos = false;
        await updateTest('test-produtos', 'error', '‚ùå Erro ao buscar produtos');
        await updateTest('test-banco', 'error', '‚ùå Problema no banco de dados');
      }
    }
    
    async function testRegistro() {
      try {
        const usuarioTeste = {
          nome: 'Teste Integra√ß√£o',
          email: `teste_${Date.now()}@dyva.com`,
          senha: '123456'
        };
        
        const response = await fetch(`${API_URL}/registro`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(usuarioTeste)
        });
        
        const data = await response.json();
        
        if(response.ok) {
          testResults.registro = true;
          await updateTest('test-registro', 'success', 
            `‚úÖ Usu√°rio criado com sucesso! ID: ${data.usuario_id}`);
          return usuarioTeste;
        } else {
          throw new Error(data.erro);
        }
      } catch(error) {
        testResults.registro = false;
        await updateTest('test-registro', 'error', 
          `‚ùå Erro: ${error.message}`);
        return null;
      }
    }
    
    async function testLogin(usuario) {
      if(!usuario) {
        await updateTest('test-login', 'error', '‚ùå Pulado (registro falhou)');
        return;
      }
      
      try {
        const response = await fetch(`${API_URL}/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            email: usuario.email,
            senha: usuario.senha
          })
        });
        
        const data = await response.json();
        
        if(response.ok && data.token) {
          testResults.login = true;
          await updateTest('test-login', 'success', 
            `‚úÖ Login OK! Token recebido: ${data.token.substring(0, 20)}...`);
        } else {
          throw new Error('Login falhou');
        }
      } catch(error) {
        testResults.login = false;
        await updateTest('test-login', 'error', '‚ùå Erro no login');
      }
    }
    
    async function iniciarTestes() {
      // Resetar todos os testes
      ['test-ping', 'test-produtos', 'test-registro', 'test-login', 'test-banco'].forEach(id => {
        const element = document.getElementById(id);
        const statusIcon = element.querySelector('.status');
        const resultText = element.querySelector('.test-result');
        statusIcon.className = 'status loading';
        statusIcon.textContent = '‚è≥';
        statusIcon.style.animation = 'pulse 1s infinite';
        resultText.textContent = 'Aguardando...';
      });
      
      document.getElementById('summary').style.display = 'none';
      
      // Executar testes sequencialmente
      const backendOnline = await testPing();
      
      if(!backendOnline) {
        document.getElementById('summary').style.display = 'block';
        document.getElementById('summary-text').textContent = 
          '‚ö†Ô∏è Backend offline. Inicie com: python app.py';
        return;
      }
      
      await testProdutos();
      const usuario = await testRegistro();
      await testLogin(usuario);
      
      // Mostrar resumo
      const sucessos = Object.values(testResults).filter(r => r).length;
      const total = Object.keys(testResults).length;
      
      document.getElementById('summary').style.display = 'block';
      document.getElementById('summary-text').textContent = 
        `${sucessos}/${total} testes passaram! Frontend ‚Üî Backend ‚Üî SQLite funcionando perfeitamente! üéâ`;
    }
    
    // Iniciar testes automaticamente
    window.onload = () => {
      setTimeout(iniciarTestes, 500);
    };
  </script>
</body>
</html>
